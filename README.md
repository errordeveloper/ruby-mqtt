ruby-mqtt
=========

Pure Ruby gem that implements the MQTT (Message Queue Telemetry Transport) protocol,
a lightweight protocol for publish/subscribe messaging.


Installing
----------

You may get the latest stable version from Rubygems:

    $ gem install mqtt


MQTT Protocol
---------------

Message publish/subscription. Wildcards.

QOS

Retain messages

Clean/Unclean sessions.

Will message



Synopsis
--------

    require 'rubygems'
    require 'mqtt'
    
    # Publish example
    MQTT::Client.connect('test.mosquitto.org') do |c|
      c.publish('topic', 'message')
    end
    
    # Subscribe example
    MQTT::Client.connect('test.mosquitto.org') do |c|
      # If you pass a block to the get method, then it will loop
      c.get('test') do |topic,message|
        puts "#{topic}: #{message}"
      end
    end

Connection:

    client = MQTT::Client.new('mqtt://myserver.example.com')
    client = MQTT::Client.new('mqtt://user:pass@myserver.example.com')
    client = MQTT::Client.new('myserver.example.com')
    client = MQTT::Client.new('myserver.example.com', 18830)
    client = MQTT::Client.new({:remote_host => 'myserver.example.com',:remote_port => 1883 ... })

The connection can be made with a block.

    client = MQTT::Client.new('myserver.example.com', 18830)
    #client stuff
    client.disconnect()

or if using a block, with an implicit disconnection at the end of the block.

    MQTT::Client.new('myserver.example.com', 18830) do |client|
        #client stuff
    end


The default options for the map parameter are:

    ATTR_DEFAULTS = {
       :remote_host => nil,
       :remote_port => MQTT::DEFAULT_PORT,
    
       :keep_alive => 15,
       :clean_session => true,
       :client_id => nil,
       :ack_timeout => 5,
       :reconnect => false,
       :username => nil,
       :password => nil,
    
       :will_topic => nil,
       :will_payload => nil,
       :will_qos => 0,
       :will_retain => false,
    
       :tls_cafile => nil,
       :tls_certfile => nil,
       :tls_keyfile => nil,
    
       :v311  => false
    }

:keep_alive Time to determine a live client/server
:clean_session Start with a new session or a unclean one (subscriptions saved or wiped respectively)
:client_id Client id sent to the server. Autogenerated if nil.
:ack_timeout Timeout to receive an ACK.
:reconnect If the connection is dropped, reconnect.

:username If the servers supports auth, the username.
:password If the servers supports auth, the username.

A will topic is a message that the server should send in the scenario of a server disconnection.
:will_topic
:will_payload
:will_qos
:will_retain

Files for SSL auth.
:tls_cafile
:tls_certfile
:tls_keyfile

By default, the messages are sent complying the MQTT 3.1.0 spec. With this parameter in true, the messages are sent based on the MQTT 3.1.1 spec.
:v311  => false


Subscribe
Select topic and qos level (0 if not provided)

    client.subscribe( 'a/b' )
    client.subscribe( 'a/b', 'c/d' )
    client.subscribe( ['a/b',0], ['c/d',1] )
    client.subscribe( 'a/b' => 0, 'c/d' => 1 )
Unsubscribe

    client.unsubscribe('topic1','topic2','topic3')

Publish

    client.publish(topic, payload, retain=false, qos=0)

Get Messages

    client.get(topic) do |topic,message|
        
    end

or

    topic,message = client.get(topic)

Limitations
-----------

 * ~~Only QOS 0 currently supported~~


Resources
---------

* MQTT Homepage: http://www.mqtt.org/
* GitHub Project: http://github.com/njh/ruby-mqtt
* API Documentation: http://rubydoc.info/gems/mqtt/frames

License
-------

The ruby-mqtt gem is licensed under the terms of the MIT license.
See the file LICENSE for details.

Contact
-------

* Author:    Nicholas J Humfrey
* Email:     njh@aelius.com
* Home Page: http://www.aelius.com/njh/
